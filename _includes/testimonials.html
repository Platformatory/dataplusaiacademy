<!-- Testimonials Section -->
    <section id="testimonials">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <h2 class="section-heading">Journey Of Our Learners</h2>
                <hr class="primary">
                <p class="text-muted">Hear from our students about their transformative learning experience</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- Dynamic Video Carousel -->
                <div class="css-carousel" data-duration="8" id="testimonial-carousel">
                    <div class="carousel-container">
                        <div class="carousel-track" id="carousel-track">
                            <!-- Videos will be dynamically loaded here -->
                        </div>
                    </div>
                    
                    <!-- Navigation Controls -->
                    <div class="carousel-nav">
                        <button class="carousel-btn prev" onclick="changeSlide(-1)">
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <button class="carousel-btn next" onclick="changeSlide(1)">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <!-- Indicators -->
                    <div class="carousel-indicators" id="carousel-indicators">
                        <!-- Indicators will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // List of testimonial videos from Jekyll data
        const testimonialVideos = [
            {% for video in site.data.testimonials.videos %}
            'videos/testimonials/{{ video.filename }}'{% unless forloop.last %},{% endunless %}
            {% endfor %}
        ];

        // Function to create video element
        function createVideoElement(videoSrc, screenSize = 'mobile') {
            const videoName = videoSrc.split('/').pop().split('.')[0];
            // Responsive column classes based on screen size
            let colClass;
            switch(screenSize) {
                case 'large':
                    colClass = 'col-lg-4 col-md-4 col-sm-12'; // 3 cards per slide
                    break;
                case 'desktop':
                    colClass = 'col-lg-6 col-md-6 col-sm-12'; // 2 cards per slide
                    break;
                case 'mobile':
                default:
                    colClass = 'col-12'; // 1 card per slide
                    break;
            }
            
            return `
                <div class="${colClass} mb-4">
                    <div class="testimonial-card">
                        <div class="video-container">
                            <video class="testimonial-video" preload="metadata" playsinline>
                                <source src="${videoSrc}" type="video/webm">
                                Your browser does not support the video tag.
                            </video>
                            <div class="play-button">
                                <i class="fa fa-play-circle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to create carousel slide
        function createCarouselSlide(videos, slideIndex, screenSize = 'mobile') {
            const isActive = slideIndex === 0 ? 'active' : '';
            const videoElements = videos.map(video => createVideoElement(video, screenSize)).join('');
            
            return `
                <div class="carousel-slide ${isActive}">
                    <div class="row justify-content-center">
                        ${videoElements}
                    </div>
                </div>
            `;
        }

        // Function to create indicators
        function createIndicators(totalSlides) {
            let indicators = '';
            for (let i = 0; i < totalSlides; i++) {
                const isActive = i === 0 ? 'active' : '';
                indicators += `<button class="indicator ${isActive}" onclick="currentSlide(${i + 1})"></button>`;
            }
            return indicators;
        }

        // Function to initialize the carousel
        function initializeTestimonialCarousel() {
            const carouselTrack = document.getElementById('carousel-track');
            const carouselIndicators = document.getElementById('carousel-indicators');
            
            if (!carouselTrack || !carouselIndicators) return;

            // Determine videos per slide and screen size based on window width
            let screenSize, videosPerSlide;
            const windowWidth = window.innerWidth;
            
            if (windowWidth >= 1200) {
                screenSize = 'large';
                videosPerSlide = 3;
            } else if (windowWidth >= 992) {
                screenSize = 'desktop';
                videosPerSlide = 2;
            } else {
                screenSize = 'mobile';
                videosPerSlide = 1;
            }
            
            const slides = [];
            
            for (let i = 0; i < testimonialVideos.length; i += videosPerSlide) {
                const slideVideos = testimonialVideos.slice(i, i + videosPerSlide);
                slides.push(slideVideos);
            }

            // Generate carousel slides
            const carouselSlides = slides.map((slideVideos, index) => 
                createCarouselSlide(slideVideos, index, screenSize)
            ).join('');

            carouselTrack.innerHTML = carouselSlides;
            carouselIndicators.innerHTML = createIndicators(slides.length);

            // Initialize carousel variables
            window.currentSlideIndex = 0;
            window.totalSlides = slides.length;
            
            // Re-bind video event handlers for dynamically generated content
            bindVideoEventHandlers();
        }

        // Function to bind video event handlers for dynamically generated content
        function bindVideoEventHandlers() {
            // Use event delegation for dynamically generated content
            $(document).off('click', '.play-button').on('click', '.play-button', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                var $videoContainer = $(this).closest('.video-container');
                var $video = $videoContainer.find('.testimonial-video');
                var $playButton = $(this);
                
                // Pause all other videos first
                $('.testimonial-video').each(function() {
                    if (this !== $video[0]) {
                        this.pause();
                        $(this).siblings('.play-button').show();
                    }
                });
                
                // Play the video and hide the play button
                $video[0].play();
                $playButton.hide();
                
                // Show play button again when video ends
                $video.off('ended').on('ended', function() {
                    $playButton.show();
                });
            });

            // Click anywhere on video to pause
            $(document).off('click', '.testimonial-video').on('click', '.testimonial-video', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                var $video = $(this);
                var $playButton = $video.siblings('.play-button');
                
                if (!$video[0].paused) {
                    // Pause the video and show play button
                    $video[0].pause();
                    $playButton.show();
                }
            });
        }

        // Handle window resize for responsive behavior
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                initializeTestimonialCarousel();
            }, 250);
        });

        // Initialize carousel when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestimonialCarousel();
            
            // Re-initialize the main carousel after dynamic content is loaded
            setTimeout(() => {
                if (typeof initCarousel === 'function') {
                    initCarousel();
                }
            }, 200);
        });
    </script>
</section>

